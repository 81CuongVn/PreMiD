<project>
    <shortName>PreMiD</shortName>
    <fullName>PreMiD</fullName>
    <version>3.0</version>
    <installerFilename>${product_shortname}-Installer.${platform_exec_suffix}</installerFilename>
    <askForConfirmationOnUninstall>0</askForConfirmationOnUninstall>
    <leftImage>leftSide.png</leftImage>
    <logoImage>logo.png</logoImage>
    <wmImage>logo.png</wmImage>
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>../dist</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux</name>
                    <platforms>linux</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux64</name>
                    <platforms>linux-x64</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>appIcon.ico</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows64</name>
                    <platforms>windows-x64</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfilesosx</name>
                    <platforms>osx</platforms>
                </folder>
            </folderList>
        </component>
    </componentList>
    <initializationActionList>
        <setInstallerVariable>
            <name>installdir</name>
            <persist>1</persist>
            <value>${windows_folder_appdata}/${product_shortname}</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>installdir</name>
            <persist>1</persist>
            <value>${platform_install_prefix}/${product_shortname}</value>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
    </initializationActionList>
    <readyToInstallActionList>
        <stopWindowsService>
            <delay>15000</delay>
            <displayName>PreMiD</displayName>
            <serviceName>PreMiD</serviceName>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
                <windowsServiceTest>
                    <condition>is_running</condition>
                    <service>PreMiD</service>
                </windowsServiceTest>
            </ruleList>
        </stopWindowsService>
    </readyToInstallActionList>
    <postInstallationActionList>
        <copyFile>
            <destination>${installdir}</destination>
            <origin>${installdir}/dist/*</origin>
        </copyFile>
        <deleteFile>
            <path>${installdir}/dist/</path>
        </deleteFile>
        <httpGet>
            <filename>${installdir}/node.exe</filename>
            <progressText>Downloading node...</progressText>
            <url>https://nodejs.org/dist/v14.2.0/win-x64/node.exe</url>
            <ruleList>
                <platformTest>
                    <type>windows-x64</type>
                </platformTest>
            </ruleList>
        </httpGet>
        <httpGet>
            <filename>${installdir}/node.exe</filename>
            <progressText>Downloading node...</progressText>
            <url>https://nodejs.org/dist/v14.2.0/win-x86/node.exe</url>
            <ruleList>
                <platformTest>
                    <type>windows-x86</type>
                </platformTest>
            </ruleList>
        </httpGet>
        <addFilesToUninstaller>
            <files>${installdir}/*</files>
        </addFilesToUninstaller>
        <runProgram>
            <program>node.exe</program>
            <programArguments>install.js</programArguments>
            <workingDirectory>${installdir}</workingDirectory>
        </runProgram>
    </postInstallationActionList>
    <preUninstallationActionList>
        <runProgram>
            <program>node.exe</program>
            <programArguments>uninstall.js</programArguments>
            <workingDirectory>${installdir}</workingDirectory>
        </runProgram>
    </preUninstallationActionList>
    <compressionAlgorithm>lzham-ultra</compressionAlgorithm>
    <disableSplashScreen>1</disableSplashScreen>
    <enableGtkDarkThemesSupport>1</enableGtkDarkThemesSupport>
    <enableRetinaDisplayImages>1</enableRetinaDisplayImages>
    <enableRollback>0</enableRollback>
    <enableSslSupport>1</enableSslSupport>
    <enableTimestamp>1</enableTimestamp>
    <osxApplicationBundleIcon>appIcon.icns</osxApplicationBundleIcon>
    <osxUninstallerApplicationBundleIcon>appIcon.icns</osxUninstallerApplicationBundleIcon>
    <outputDirectory>..</outputDirectory>
    <overwritePolicy>onlyIfNewer</overwritePolicy>
    <productDisplayIcon>${installdir}/appIcon.ico</productDisplayIcon>
    <productUrlHelpLink>https://discord.premid.app</productUrlHelpLink>
    <productUrlInfoAbout>https://premid.app</productUrlInfoAbout>
    <saveRelativePaths>1</saveRelativePaths>
    <showDownloadableComponentsProxyPage>0</showDownloadableComponentsProxyPage>
    <singleInstanceCheck>1</singleInstanceCheck>
    <vendor>Timeraa</vendor>
    <windowsARPRegistryPrefix>${project.fullName}</windowsARPRegistryPrefix>
    <windowsExecutableIcon>appIcon.ico</windowsExecutableIcon>
    <windowsUninstallerExecutableIcon>appIcon.ico</windowsUninstallerExecutableIcon>
</project>

